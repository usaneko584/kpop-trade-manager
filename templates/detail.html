<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit - K-Life</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* èƒŒæ™¯ï¼šæ§ãˆã‚ãªãƒ‰ãƒƒãƒˆã§éŸ“å›½ã‚«ãƒ•ã‚§æ„Ÿã‚’æ¼”å‡º */
        body { 
            background-color: #fdf6f9; 
            background-image: radial-gradient(#ffb6c1 0.5px, transparent 0.5px); 
            background-size: 24px 24px;
            font-family: 'M PLUS Rounded 1c', sans-serif; 
            color: #5e5e5e; 
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ å®¹å™¨ï¼šã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ  */
        .form-container { 
            background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(10px);
            padding: 2.5rem; 
            border-radius: 35px; 
            border: 1px solid #ffffff;
            box-shadow: 0 15px 35px rgba(255,182,193,0.2); 
        }

        /* ãƒ©ãƒ™ãƒ«ï¼šã‚¹ãƒ†ãƒƒã‚«ãƒ¼é¢¨ */
        .label-give { background-color: #ffe4ed; color: #ff99aa; padding: 2px 12px; border-radius: 12px; font-size: 0.8rem; }
        .label-get { background-color: #e0f7ff; color: #00bfff; padding: 2px 12px; border-radius: 12px; font-size: 0.8rem; }

        .form-control, .form-select { 
            border-radius: 18px; border: 1px solid #ffe4ed; padding: 10px; 
            background-color: rgba(255, 255, 255, 0.9);
        }

        /* ä¿å­˜ãƒœã‚¿ãƒ³ï¼šã‚­ãƒ£ãƒ³ãƒ‡ã‚£è³ªæ„Ÿ */
        .btn-primary { 
            background: linear-gradient(135deg, #ffb6c1 0%, #ff99aa 100%); 
            border: none; border-radius: 25px; font-weight: bold; width: 100%; 
            box-shadow: 0 5px 15px rgba(255, 182, 193, 0.4);
            transition: transform 0.2s;
        }
        .btn-primary:hover { transform: translateY(-2px); filter: brightness(1.05); }

        /* ç™ºé€ãƒ†ãƒ³ãƒ—ãƒ¬ç”¨ãƒœãƒƒã‚¯ã‚¹ */
        .template-box { 
            background-color: rgba(255, 249, 251, 0.9); 
            border: 2px dashed #ffb6c1; border-radius: 25px; padding: 20px; 
        }

        hr { border-top: 1px dashed #ffb6c1; opacity: 0.5; }
    </style>
</head>
<body>
<div class="container py-5" style="max-width: 500px;">
    <div class="form-container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="h5 fw-bold m-0" style="color: #ff99aa;">ğŸ“ Edit Trade</h3>
            <a href="/delete/{{ trade.id }}" class="text-danger small text-decoration-none fw-bold" onclick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼ŸğŸ’Œ');">
                <i class="bi bi-trash3 me-1"></i>Delete
            </a>
        </div>

        <form action="/update/{{ trade.id }}" method="post">
            <div class="mb-4">
                <label class="small fw-bold mb-2">Twitter ID</label>
                <input type="text" name="partner_name" class="form-control" value="{{ trade.partner_name }}">
            </div>

            <div class="mb-4">
                <label class="small fw-bold mb-2">Status (çŠ¶æ³)</label>
                <select name="status" class="form-select">
                    <option value="äº¤æ¸‰ä¸­" {% if trade.status == 'äº¤æ¸‰ä¸­' %}selected{% endif %}>äº¤æ¸‰ä¸­</option>
                    <option value="ç™ºé€å¾…ã¡" {% if trade.status == 'ç™ºé€å¾…ã¡' %}selected{% endif %}>ç™ºé€å¾…ã¡</option>
                    <option value="å—å–å¾…ã¡" {% if trade.status == 'å—å–å¾…ã¡' %}selected{% endif %}>å—å–å¾…ã¡</option>
                    <option value="å®Œäº†" {% if trade.status == 'å®Œäº†' %}selected{% endif %}>å®Œäº†</option>
                </select>
            </div>

            <div class="row mb-4">
                <div class="mb-3">
                    <label class="label-give fw-bold mb-2">è­²ï¼šã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå</label>
                    <input type="text" name="give_artist" class="form-control" value="{{ trade.give_artist or '' }}">
                </div>
                <div class="mb-3">
                    <label class="small fw-bold mb-2 text-muted">è­²ï¼šãƒˆãƒ¬ã‚«è©³ç´°</label>
                    <input type="text" name="give_item" class="form-control" value="{{ trade.give_item or '' }}">
                </div>

                <hr class="my-4">

                <div class="mb-3">
                    <label class="label-get fw-bold mb-2">æ±‚ï¼šã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå</label>
                    <input type="text" name="get_artist" class="form-control" value="{{ trade.get_artist or '' }}">
                </div>
                <div class="mb-3">
                    <label class="small fw-bold mb-2 text-muted">æ±‚ï¼šãƒˆãƒ¬ã‚«è©³ç´°</label>
                    <input type="text" name="get_item" class="form-control" value="{{ trade.get_item or '' }}">
                </div>
            </div>

            <div class="mb-4">
                <label class="small fw-bold mb-2">ğŸ“« è¿½è·¡ç•ªå·</label>
                <input type="text" name="tracking_number" class="form-control" value="{{ trade.tracking_number or '' }}" placeholder="æœªè¨­å®š">
            </div>

            <button type="submit" class="btn btn-primary mb-3">Save Changes</button>
            <div class="text-center"><a href="/" class="small text-muted text-decoration-none">Back to List</a></div>
        </form>

        <div class="template-box mt-5">
            <h6 class="fw-bold mb-3 small" style="color: #ff99aa;">ğŸ€ Shipping Template</h6>
            <textarea id="tempText" class="form-control border-0 bg-white small mb-3" rows="4">ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€{{ user.name }}ã§ã™ã€‚æœ¬æ—¥ç™ºé€ã„ãŸã—ã¾ã—ãŸã€‚
è¿½è·¡ç•ªå·ï¼š{{ trade.tracking_number or 'ãªã—' }}
ç„¡äº‹ã«å±Šãã¾ã™ã‚ˆã†ã«ğŸ’Œ</textarea>

            <div class="d-flex gap-2">
                <button onclick="copyMsg()" class="btn btn-sm btn-primary flex-grow-1 rounded-pill">
                    Copy Message
                </button>
                <button onclick="saveTemplate()" class="btn btn-sm btn-outline-secondary rounded-pill px-3">
                    <i class="bi bi-save2"></i> ãƒ†ãƒ³ãƒ—ãƒ¬ä¿å­˜
                </button>
            </div>
        </div>
    </div>
</div>

<script>
window.onload = function() {
    const savedTemp = localStorage.getItem('k_life_shipping_msg');
    if (savedTemp) {
        let msg = savedTemp
            .replace('{NAME}', '{{ user.name }}')
            .replace('{NUMBER}', '{{ trade.tracking_number or "ãªã—" }}');
        document.getElementById("tempText").value = msg;
    }
}
function saveTemplate() {
    let currentMsg = document.getElementById("tempText").value;
    let templateToSave = currentMsg
        .replace('{{ user.name }}', '{NAME}')
        .replace('{{ trade.tracking_number or "ãªã—" }}', '{NUMBER}');
    localStorage.setItem('k_life_shipping_msg', templateToSave);
    alert("ã“ã®æ–‡é¢ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸï¼ğŸ’–");
}
function copyMsg(){
    var t = document.getElementById("tempText");
    t.select();
    navigator.clipboard.writeText(t.value);
    alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸğŸ’Œ");
}
</script>
</body>
</html>
