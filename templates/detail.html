<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit - K-Trade</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>body { background-color: #fdf6f9; font-family: 'M PLUS Rounded 1c', sans-serif; color: #5e5e5e; } .form-container { background: white; padding: 2rem; border-radius: 30px; box-shadow: 0 10px 30px rgba(255,182,193,0.15); } .form-control, .form-select { border-radius: 15px; border: 1px solid #ffe4ed; padding: 10px; } .btn-primary { background-color: #ffb6c1; border: none; border-radius: 25px; font-weight: bold; width: 100%; } .template-box { background-color: #fff9fb; border: 1px dashed #ffb6c1; border-radius: 20px; padding: 15px; }</style>
</head>
<body>
<div class="container py-5" style="max-width: 500px;">
    <div class="form-container">
        <div class="d-flex justify-content-between mb-4"><h3 class="h5 fw-bold m-0" style="color: #ff99aa;">ğŸ“ Edit</h3><a href="/delete/{{ trade.id }}" class="text-danger small text-decoration-none" onclick="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">Delete</a></div>
        <form action="/update/{{ trade.id }}" method="post" enctype="multipart/form-data">
    <div class="mb-3"><label class="small fw-bold">Twitter ID</label><input type="text" name="partner_name" class="form-control" value="{{ trade.partner_name }}"></div>
    
    <div class="mb-3">
        <label class="small fw-bold">Status (çŠ¶æ³)</label>
        <select name="status" class="form-select">
            <option value="äº¤æ¸‰ä¸­" {% if trade.status == 'äº¤æ¸‰ä¸­' %}selected{% endif %}>äº¤æ¸‰ä¸­</option>
            <option value="ç™ºé€å¾…ã¡" {% if trade.status == 'ç™ºé€å¾…ã¡' %}selected{% endif %}>ç™ºé€å¾…ã¡</option>
            <option value="å—å–å¾…ã¡" {% if trade.status == 'å—å–å¾…ã¡' %}selected{% endif %}>å—å–å¾…ã¡</option>
            <option value="å®Œäº†" {% if trade.status == 'å®Œäº†' %}selected{% endif %}>å®Œäº†</option>
        </select>
    </div>

    <div class="row mb-3">
        <div class="col-6">
            <label class="small fw-bold">è­²ã‚¢ã‚¤ãƒ†ãƒ ç”»åƒ</label>
            <input type="file" name="give_file" class="form-control" accept="image/*">
        </div>
        <div class="col-6">
            <label class="small fw-bold">æ±‚ã‚¢ã‚¤ãƒ†ãƒ ç”»åƒ</label>
            <input type="file" name="get_file" class="form-control" accept="image/*">
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-6"><label class="small fw-bold text-primary">ğŸŒ å…¬é–‹</label>
            <select name="is_public" class="form-select border-primary">
                <option value="false" {% if not trade.is_public %}selected{% endif %}>éå…¬é–‹</option>
                <option value="true" {% if trade.is_public %}selected{% endif %}>å…¬é–‹ä¸­</option>
            </select>
        </div>
        <div class="col-6"><label class="small fw-bold">è¿½è·¡ç•ªå·</label><input type="text" name="tracking_number" class="form-control" value="{{ trade.tracking_number or '' }}"></div>
    </div>

    <button type="submit" class="btn btn-primary mb-3">Save Changes</button>
    <div class="text-center"><a href="/" class="small text-muted text-decoration-none">Back</a></div>
</form>
        <div class="template-box mt-4">
    <h6 class="fw-bold mb-2 small" style="color: #ff99aa;">ğŸ€ Shipping Template</h6>
    
    <textarea id="tempText" class="form-control border-0 bg-white small mb-2" rows="4">ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€{{ user.name }}ã§ã™ã€‚æœ¬æ—¥ç™ºé€ã„ãŸã—ã¾ã—ãŸã€‚
è¿½è·¡ç•ªå·ï¼š{{ trade.tracking_number or 'ãªã—' }}
ç„¡äº‹ã«å±Šãã¾ã™ã‚ˆã†ã«ğŸ’Œ</textarea>

    <div class="d-flex gap-2">
        <button onclick="copyMsg()" class="btn btn-sm btn-primary flex-grow-1 rounded-pill">
            Copy Message
        </button>
        <button onclick="saveTemplate()" class="btn btn-sm btn-outline-secondary rounded-pill px-3" title="ã“ã®æ–‡é¢ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã™ã‚‹">
            <i class="bi bi-save"></i> ä¿å­˜
        </button>
    </div>
    <p class="text-center mt-2 mb-0" style="font-size: 0.6rem; color: #ffb6c1;">â€»ã€Œä¿å­˜ã€ã™ã‚‹ã¨ã€æ¬¡å›ã‹ã‚‰ã“ã®æ–‡é¢ãŒè‡ªå‹•ã§è¡¨ç¤ºã•ã‚Œã¾ã™âœ¨</p>
</div>

<script>
// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¿å­˜ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãŒã‚ã‚Œã°åæ˜ ã™ã‚‹
window.onload = function() {
    const savedTemp = localStorage.getItem('k_life_shipping_msg');
    if (savedTemp) {
        // ä¿å­˜ã•ã‚ŒãŸæ–‡é¢å†…ã® [NAME] ã‚„ [NUMBER] ã‚’å®Ÿéš›ã®å€¤ã«ç½®æ›ã—ã¦è¡¨ç¤º
        let msg = savedTemp
            .replace('{NAME}', '{{ user.name }}')
            .replace('{NUMBER}', '{{ trade.tracking_number or "ãªã—" }}');
        document.getElementById("tempText").value = msg;
    }
}

// ç·¨é›†ã—ãŸæ–‡é¢ã‚’ã€Œå‹ã€ã¨ã—ã¦ä¿å­˜ã™ã‚‹
function saveTemplate() {
    let currentMsg = document.getElementById("tempText").value;
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ç•ªå·ã®éƒ¨åˆ†ã‚’ã€æ¬¡å›ä½¿ã„å›ã›ã‚‹ã‚ˆã†ã«ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«æˆ»ã—ã¦ä¿å­˜
    let templateToSave = currentMsg
        .replace('{{ user.name }}', '{NAME}')
        .replace('{{ trade.tracking_number or "ãªã—" }}', '{NUMBER}');
    
    localStorage.setItem('k_life_shipping_msg', templateToSave);
    alert("ã“ã®æ–‡é¢ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸï¼ğŸ’–");
}

function copyMsg(){
    var t = document.getElementById("tempText");
    t.select();
    navigator.clipboard.writeText(t.value);
    alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸğŸ’Œ");
}
</script>
</body>
</html>
